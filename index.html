<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>ğŸ’° ê°€ê³„ë¶€</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #fafafa; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    input, select, button { font-family: inherit; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const DEFAULT_EXP_CATS = ["ì‹ë¹„","êµí†µ","ì‡¼í•‘","ì˜ë£Œ","ë¬¸í™”/ì—¬ê°€","ê¸°íƒ€"];
    const DEFAULT_INC_CATS = ["ê¸‰ì—¬","ë¶€ì—…","ìš©ëˆ","ê¸°íƒ€ìˆ˜ì…"];
    const COLORS = ["#6366f1","#f59e0b","#10b981","#ef4444","#3b82f6","#ec4899","#8b5cf6","#14b8a6","#f97316","#a3e635"];

    const today = () => new Date().toISOString().split("T")[0];
    const fmt = n => n.toLocaleString("ko-KR") + "ì›";
    const lbl = { display:"block", fontSize:13, color:"#888", marginBottom:6, fontWeight:500 };
    const inp = { width:"100%", padding:"12px 14px", border:"1px solid #e8e8e8", borderRadius:10, fontSize:15, background:"#fff", boxSizing:"border-box", outline:"none" };

    function load(key, fallback) {
      try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; } catch { return fallback; }
    }
    function save(key, val) { try { localStorage.setItem(key, JSON.stringify(val)); } catch {} }

    // íŒŒì´ì°¨íŠ¸ (Canvas)
    function PieChart({ data }) {
      const ref = useRef();
      useEffect(() => {
        const canvas = ref.current;
        if (!canvas) return;
        const ctx = canvas.getContext("2d");
        const W = canvas.width, H = canvas.height;
        const cx = W / 2, cy = H / 2, r = Math.min(W, H) / 2 - 10;
        ctx.clearRect(0, 0, W, H);
        const total = data.reduce((s, d) => s + d.value, 0);
        if (total === 0) return;
        let angle = -Math.PI / 2;
        data.forEach(d => {
          const slice = (d.value / total) * Math.PI * 2;
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.arc(cx, cy, r, angle, angle + slice);
          ctx.closePath();
          ctx.fillStyle = d.color;
          ctx.fill();
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 2;
          ctx.stroke();
          // ë¼ë²¨
          const pct = Math.round((d.value / total) * 100);
          if (pct >= 5) {
            const mid = angle + slice / 2;
            const lx = cx + Math.cos(mid) * r * 0.65;
            const ly = cy + Math.sin(mid) * r * 0.65;
            ctx.fillStyle = "#fff";
            ctx.font = "bold 13px system-ui,sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(pct + "%", lx, ly);
          }
          angle += slice;
        });
      }, [data]);
      return <canvas ref={ref} width={280} height={280} style={{display:"block",margin:"0 auto"}} />;
    }

    function roundRect(ctx, x, y, w, h, r, fill) {
      ctx.beginPath();
      ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y); ctx.quadraticCurveTo(x+w,y,x+w,y+r);
      ctx.lineTo(x+w,y+h-r); ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
      ctx.lineTo(x+r,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-r);
      ctx.lineTo(x,y+r); ctx.quadraticCurveTo(x,y,x+r,y);
      ctx.closePath();
      if (fill) { ctx.fillStyle = fill; ctx.fill(); }
    }

    function drawAndDownload(range, entries, excludedCats) {
      const filtered = entries.filter(e => e.date >= range.start && e.date <= range.end).sort((a,b) => b.date.localeCompare(a.date));
      const incList = filtered.filter(e => e.type === "income");
      const expList = filtered.filter(e => e.type === "expense");
      const totalI = incList.reduce((s,e) => s+e.amount, 0);
      const totalE = expList.filter(e => !excludedCats.includes(e.category)).reduce((s,e) => s+e.amount, 0);
      const bal = totalI - totalE;
      const excTotal = expList.filter(e => excludedCats.includes(e.category)).reduce((s,e) => s+e.amount, 0);
      const W=750, ROW=52, HEADER=200, SECTION=44, PAD=28;
      const H = HEADER + (filtered.length > 0 ? (incList.length+expList.length+4)*ROW + SECTION*2 + 60 : 100) + PAD*2;
      const canvas = document.createElement("canvas");
      canvas.width = W; canvas.height = Math.max(H, 400);
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "#f8f8fc"; ctx.fillRect(0,0,W,canvas.height);
      const grad = ctx.createLinearGradient(0,0,W,0); grad.addColorStop(0,"#6366f1"); grad.addColorStop(1,"#818cf8");
      roundRect(ctx,PAD,PAD,W-PAD*2,160,20,grad);
      ctx.fillStyle="#fff"; ctx.font="bold 22px system-ui,sans-serif"; ctx.textAlign="left"; ctx.fillText("ğŸ’° ê°€ê³„ë¶€ ë‚´ì—­",PAD+20,PAD+38);
      ctx.font="15px system-ui,sans-serif"; ctx.fillStyle="rgba(255,255,255,0.85)"; ctx.fillText(`${range.start} ~ ${range.end}`,PAD+20,PAD+64);
      ctx.font="13px system-ui,sans-serif"; ctx.fillStyle="rgba(255,255,255,0.75)";
      ctx.fillText("ì´ ìˆ˜ì…",PAD+20,PAD+96); ctx.fillText("ì´ ì§€ì¶œ",W/2,PAD+96);
      ctx.font="bold 22px system-ui,sans-serif"; ctx.fillStyle="#fff";
      ctx.fillText(fmt(totalI),PAD+20,PAD+124); ctx.fillText(fmt(totalE),W/2,PAD+124);
      roundRect(ctx,PAD+16,PAD+136,W-PAD*2-32,36,10,"rgba(255,255,255,0.18)");
      ctx.font="13px system-ui,sans-serif"; ctx.fillStyle="rgba(255,255,255,0.9)"; ctx.fillText("ì”ì•¡",PAD+30,PAD+158);
      ctx.font="bold 18px system-ui,sans-serif"; ctx.fillStyle=bal>=0?"#a7f3d0":"#fca5a5";
      const balText=(bal>=0?"+":"")+fmt(bal); ctx.textAlign="right"; ctx.fillText(balText,W-PAD-20,PAD+158); ctx.textAlign="left";
      let y = PAD+180;
      const drawSection=(label,list,typeColor)=>{
        if(!list.length) return;
        roundRect(ctx,PAD,y,W-PAD*2,SECTION,10,"#f0f0f0");
        ctx.font="bold 15px system-ui,sans-serif"; ctx.fillStyle=typeColor; ctx.fillText(label,PAD+16,y+28); y+=SECTION+6;
        list.forEach(e=>{
          const isExc=excludedCats.includes(e.category);
          roundRect(ctx,PAD,y,W-PAD*2,ROW-4,12,"#fff");
          roundRect(ctx,PAD+12,y+12,72,24,8,typeColor+"22");
          ctx.font="bold 12px system-ui,sans-serif"; ctx.fillStyle=typeColor; ctx.fillText(e.category.slice(0,5),PAD+18,y+29);
          if(isExc){roundRect(ctx,PAD+90,y+12,68,24,8,"#eee");ctx.font="11px system-ui,sans-serif";ctx.fillStyle="#aaa";ctx.fillText("ì§‘ê³„ ì œì™¸",PAD+96,y+29);}
          ctx.font="13px system-ui,sans-serif"; ctx.fillStyle="#aaa"; ctx.fillText(e.date,PAD+170,y+29);
          if(e.memo){ctx.fillStyle="#666";ctx.fillText(e.memo.slice(0,18),PAD+270,y+29);}
          const amtTxt=(e.type==="expense"?"-":"+")+e.amount.toLocaleString("ko-KR")+"ì›";
          ctx.font="bold 16px system-ui,sans-serif"; ctx.fillStyle=isExc?"#bbb":typeColor;
          ctx.textAlign="right"; ctx.fillText(amtTxt,W-PAD-16,y+30); ctx.textAlign="left"; y+=ROW;
        }); y+=10;
      };
      if(!filtered.length){ctx.font="16px system-ui,sans-serif";ctx.fillStyle="#bbb";ctx.textAlign="center";ctx.fillText("í•´ë‹¹ ê¸°ê°„ì— ë‚´ì—­ì´ ì—†ì–´ìš”",W/2,y+60);}
      else{drawSection("ğŸ’š ìˆ˜ì… ë‚´ì—­",incList,"#10b981");drawSection("ğŸ”´ ì§€ì¶œ ë‚´ì—­",expList,"#ef4444");}
      ctx.font="12px system-ui,sans-serif";ctx.fillStyle="#ccc";ctx.textAlign="center";ctx.fillText(`ë‚´ë³´ë‚¸ ë‚ ì§œ: ${new Date().toLocaleDateString("ko-KR")}`,W/2,canvas.height-14);
      const link=document.createElement("a"); link.download=`ê°€ê³„ë¶€_${range.start}_${range.end}.jpg`; link.href=canvas.toDataURL("image/jpeg",0.92); link.click();
    }

    function CatManager({title,cats,setCats,newCat,setNewCat,color,excludedCats,toggleExclude,showExclude}){
      const [open,setOpen]=useState(false);
      const add=()=>{if(!newCat.trim()||cats.includes(newCat.trim()))return;setCats(p=>[...p,newCat.trim()]);setNewCat("");};
      return(
        <div style={{background:"#fff",border:"1px solid #e8e8e8",borderRadius:14,overflow:"hidden"}}>
          <button onClick={()=>setOpen(o=>!o)} style={{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
            <span style={{fontWeight:700,fontSize:15}}>{title}</span>
            <span style={{fontSize:13,color:"#aaa",display:"flex",alignItems:"center",gap:6}}>{cats.length}ê°œ<span style={{fontSize:18,transform:open?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s",display:"inline-block"}}>âŒ„</span></span>
          </button>
          {open&&<div style={{padding:"0 16px 16px"}}>
            <div style={{display:"flex",gap:8,marginBottom:12}}>
              <input type="text" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬" value={newCat} onChange={e=>setNewCat(e.target.value)} onKeyDown={e=>e.key==="Enter"&&add()} style={{...inp,flex:1,marginBottom:0}}/>
              <button onClick={add} style={{background:color,color:"#fff",border:"none",borderRadius:10,padding:"0 16px",fontWeight:700,cursor:"pointer",fontSize:20}}>+</button>
            </div>
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {cats.map(c=>{const isExc=excludedCats.includes(c);return(
                <div key={c} style={{background:"#fafafa",border:"1px solid #f0f0f0",borderRadius:12,padding:"10px 14px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                  <span style={{fontSize:14,color:isExc?"#aaa":"#111",textDecoration:isExc?"line-through":"none"}}>{c}</span>
                  <div style={{display:"flex",alignItems:"center",gap:10}}>
                    {showExclude&&<button onClick={()=>toggleExclude(c)} style={{background:isExc?"#f5f5f5":color+"22",color:isExc?"#aaa":color,border:`1px solid ${isExc?"#e0e0e0":color+"55"}`,borderRadius:20,padding:"3px 10px",fontSize:12,fontWeight:600,cursor:"pointer"}}>{isExc?"ì§‘ê³„ ì œì™¸ ì¤‘":"ì§‘ê³„ í¬í•¨"}</button>}
                    <button onClick={()=>setCats(p=>p.filter(x=>x!==c))} style={{background:"none",border:"none",color:"#ccc",cursor:"pointer",fontSize:18,lineHeight:1,padding:0}}>Ã—</button>
                  </div>
                </div>
              );})}
            </div>
          </div>}
        </div>
      );
    }

    function HomeList({entries,delEntry,excludedCats}){
      const [filter,setFilter]=useState("all");
      const sorted=[...entries].filter(e=>filter==="all"||e.type===filter).sort((a,b)=>b.date.localeCompare(a.date));
      return(<>
        <div style={{display:"flex",background:"#f0f0f0",borderRadius:10,padding:3,marginBottom:14}}>
          {[["all","ì „ì²´"],["expense","ì§€ì¶œ"],["income","ìˆ˜ì…"]].map(([k,l])=>(
            <button key={k} onClick={()=>setFilter(k)} style={{flex:1,padding:"8px 0",border:"none",borderRadius:8,background:filter===k?"#fff":"transparent",color:filter===k?"#6366f1":"#888",fontWeight:filter===k?700:400,fontSize:13,cursor:"pointer",boxShadow:filter===k?"0 1px 4px rgba(0,0,0,0.08)":"none"}}>{l}</button>
          ))}
        </div>
        {sorted.length===0
          ?<div style={{textAlign:"center",color:"#bbb",marginTop:60,fontSize:14}}><div style={{fontSize:36,marginBottom:12}}>ğŸ“</div>ë‚´ì—­ì´ ì—†ì–´ìš”<br/>ì…ë ¥ íƒ­ì—ì„œ ì¶”ê°€í•´ ë³´ì„¸ìš”</div>
          :<div style={{display:"flex",flexDirection:"column",gap:8}}>
            {sorted.map(e=>{const isExc=excludedCats.includes(e.category);return(
              <div key={e.id} style={{background:"#fff",borderRadius:12,padding:"14px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 1px 4px rgba(0,0,0,0.06)",opacity:isExc?0.6:1}}>
                <div>
                  <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4,flexWrap:"wrap"}}>
                    <span style={{background:e.type==="expense"?"#fff0f0":"#f0fff8",color:e.type==="expense"?"#ef4444":"#10b981",borderRadius:6,padding:"2px 8px",fontSize:12,fontWeight:600}}>{e.category}</span>
                    {isExc&&<span style={{background:"#f5f5f5",color:"#aaa",borderRadius:6,padding:"2px 7px",fontSize:11}}>ì§‘ê³„ ì œì™¸</span>}
                    <span style={{fontSize:12,color:"#aaa"}}>{e.date}</span>
                  </div>
                  {e.memo&&<div style={{fontSize:13,color:"#666"}}>{e.memo}</div>}
                </div>
                <div style={{display:"flex",alignItems:"center",gap:10}}>
                  <span style={{fontWeight:700,fontSize:16,color:isExc?"#aaa":e.type==="expense"?"#ef4444":"#10b981"}}>{e.type==="expense"?"-":"+"}{e.amount.toLocaleString("ko-KR")}ì›</span>
                  <button onClick={()=>delEntry(e.id)} style={{background:"none",border:"none",color:"#ccc",fontSize:18,cursor:"pointer",lineHeight:1}}>Ã—</button>
                </div>
              </div>
            );})}
          </div>
        }
      </>);
    }

    function App(){
      const [page,setPage]=useState("home");
      const [addType,setAddType]=useState("expense");
      const [period,setPeriod]=useState(()=>load("period",{start:today(),end:today()}));
      const [expCats,setExpCats]=useState(()=>load("expCats",DEFAULT_EXP_CATS));
      const [incCats,setIncCats]=useState(()=>load("incCats",DEFAULT_INC_CATS));
      const [excludedCats,setExcludedCats]=useState(()=>load("excludedCats",[]));
      const [entries,setEntries]=useState(()=>load("entries",[]));
      const [form,setForm]=useState({date:today(),category:"",amount:"",memo:""});
      const [newExpCat,setNewExpCat]=useState("");
      const [newIncCat,setNewIncCat]=useState("");
      const [budget,setBudget]=useState(()=>load("budget",""));
      const [statsType,setStatsType]=useState("expense");
      const [exportRange,setExportRange]=useState({start:today(),end:today()});
      const [exporting,setExporting]=useState(false);

      useEffect(()=>save("period",period),[period]);
      useEffect(()=>save("expCats",expCats),[expCats]);
      useEffect(()=>save("incCats",incCats),[incCats]);
      useEffect(()=>save("excludedCats",excludedCats),[excludedCats]);
      useEffect(()=>save("entries",entries),[entries]);
      useEffect(()=>save("budget",budget),[budget]);
      useEffect(()=>setForm(f=>({...f,category:""})),[addType]);

      const toggleExclude=c=>setExcludedCats(p=>p.includes(c)?p.filter(x=>x!==c):[...p,c]);
      const addEntry=()=>{
        if(!form.category||!form.amount||isNaN(Number(form.amount))||Number(form.amount)<=0)return;
        setEntries(p=>[...p,{id:Date.now(),type:addType,...form,amount:Number(form.amount)}]);
        setForm(f=>({...f,amount:"",memo:""}));
      };
      const delEntry=id=>setEntries(p=>p.filter(e=>e.id!==id));

      const counted=entries.filter(e=>!excludedCats.includes(e.category));
      const totalExp=counted.filter(e=>e.type==="expense").reduce((s,e)=>s+e.amount,0);
      const totalInc=counted.filter(e=>e.type==="income").reduce((s,e)=>s+e.amount,0);
      const balance=totalInc-totalExp;
      const excTotal=entries.filter(e=>excludedCats.includes(e.category)&&e.type==="expense").reduce((s,e)=>s+e.amount,0);
      const cats=addType==="expense"?expCats:incCats;
      const statsEntries=entries.filter(e=>e.type===statsType&&!excludedCats.includes(e.category));
      const statsTotal=statsEntries.reduce((s,e)=>s+e.amount,0);
      const statsCats=(statsType==="expense"?expCats:incCats).filter(c=>!excludedCats.includes(c)).map((c,i)=>{
        const sum=statsEntries.filter(e=>e.category===c).reduce((s,e)=>s+e.amount,0);
        return{name:c,value:sum,color:COLORS[i%COLORS.length]};
      }).filter(x=>x.value>0);

      const handleExport=async()=>{
        setExporting(true);
        await new Promise(r=>setTimeout(r,100));
        try{drawAndDownload(exportRange,entries,excludedCats);}catch(e){console.error(e);}
        setExporting(false);
      };

      return(
        <div style={{maxWidth:430,margin:"0 auto",minHeight:"100vh",background:"#fafafa"}}>
          <div style={{background:"#fff",borderBottom:"1px solid #f0f0f0",padding:"16px 20px 0",position:"sticky",top:0,zIndex:10}}>
            <div style={{fontSize:18,fontWeight:700,color:"#111",marginBottom:12}}>ğŸ’° ê°€ê³„ë¶€</div>
            <div style={{display:"flex"}}>
              {[["home","ë‚´ì—­"],["add","ì…ë ¥"],["stats","í†µê³„"],["settings","ì„¤ì •"]].map(([k,l])=>(
                <button key={k} onClick={()=>setPage(k)} style={{flex:1,padding:"10px 0",background:"none",border:"none",borderBottom:page===k?"2px solid #6366f1":"2px solid transparent",color:page===k?"#6366f1":"#888",fontWeight:page===k?700:400,fontSize:14,cursor:"pointer"}}>{l}</button>
              ))}
            </div>
          </div>

          <div style={{padding:"20px 16px",paddingBottom:40}}>
            {page==="home"&&(
              <div>
                <div style={{background:"#6366f1",borderRadius:16,padding:"18px 20px",marginBottom:16,color:"#fff"}}>
                  <div style={{fontSize:12,opacity:0.8,marginBottom:4}}>ì •ì‚° ê¸°ê°„</div>
                  <div style={{fontSize:14,fontWeight:600,marginBottom:14}}>{period.start} ~ {period.end}</div>
                  <div style={{display:"flex",justifyContent:"space-between",marginBottom:12}}>
                    <div><div style={{fontSize:11,opacity:0.75,marginBottom:2}}>ì´ ìˆ˜ì…</div><div style={{fontSize:20,fontWeight:800}}>{fmt(totalInc)}</div></div>
                    <div style={{textAlign:"right"}}><div style={{fontSize:11,opacity:0.75,marginBottom:2}}>ì´ ì§€ì¶œ</div><div style={{fontSize:20,fontWeight:800}}>{fmt(totalExp)}</div></div>
                  </div>
                  <div style={{background:"rgba(255,255,255,0.15)",borderRadius:10,padding:"10px 14px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:excTotal>0?8:0}}>
                    <span style={{fontSize:13}}>ì”ì•¡</span>
                    <span style={{fontWeight:800,fontSize:18,color:balance>=0?"#a7f3d0":"#fca5a5"}}>{balance>=0?"+":""}{fmt(balance)}</span>
                  </div>
                  {excTotal>0&&<div style={{background:"rgba(255,255,255,0.1)",borderRadius:10,padding:"8px 14px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:budget?8:0}}><span style={{fontSize:12,opacity:0.8}}>ì§‘ê³„ ì œì™¸ ê¸ˆì•¡</span><span style={{fontSize:13,opacity:0.9}}>{fmt(excTotal)}</span></div>}
                  {budget&&<div style={{background:"rgba(255,255,255,0.1)",borderRadius:10,padding:"8px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontSize:12,opacity:0.85}}>ì˜ˆì‚° ëŒ€ë¹„ ì§€ì¶œ</span><span style={{fontWeight:700,fontSize:14,color:totalExp>Number(budget)?"#fca5a5":"#a7f3d0"}}>{fmt(totalExp)} / {fmt(Number(budget))}</span></div>}
                </div>
                <HomeList entries={entries} delEntry={delEntry} excludedCats={excludedCats}/>
              </div>
            )}

            {page==="add"&&(
              <div style={{display:"flex",flexDirection:"column",gap:14}}>
                <div style={{fontWeight:700,fontSize:16,marginBottom:4}}>ì§€ì¶œ/ìˆ˜ì… ì…ë ¥</div>
                <div style={{display:"flex",background:"#f0f0f0",borderRadius:10,padding:3}}>
                  {[["expense","ì§€ì¶œ"],["income","ìˆ˜ì…"]].map(([k,l])=>(
                    <button key={k} onClick={()=>setAddType(k)} style={{flex:1,padding:"9px 0",border:"none",borderRadius:8,background:addType===k?"#fff":"transparent",color:addType===k?k==="expense"?"#ef4444":"#10b981":"#888",fontWeight:addType===k?700:400,fontSize:15,cursor:"pointer",boxShadow:addType===k?"0 1px 4px rgba(0,0,0,0.1)":"none"}}>{l}</button>
                  ))}
                </div>
                <div><label style={lbl}>ë‚ ì§œ</label><input type="date" value={form.date} onChange={e=>setForm(f=>({...f,date:e.target.value}))} style={inp}/></div>
                <div><label style={lbl}>ì¹´í…Œê³ ë¦¬</label>
                  <select value={form.category} onChange={e=>setForm(f=>({...f,category:e.target.value}))} style={inp}>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    {cats.map(c=><option key={c} value={c}>{c}{excludedCats.includes(c)?" (ì§‘ê³„ ì œì™¸)":""}</option>)}
                  </select>
                </div>
                <div><label style={lbl}>ê¸ˆì•¡ (ì›)</label><input type="number" placeholder="0" value={form.amount} onChange={e=>setForm(f=>({...f,amount:e.target.value}))} style={inp}/></div>
                <div><label style={lbl}>ë©”ëª¨ (ì„ íƒ)</label><input type="text" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" value={form.memo} onChange={e=>setForm(f=>({...f,memo:e.target.value}))} style={inp}/></div>
                <button onClick={addEntry} style={{background:addType==="expense"?"#ef4444":"#10b981",color:"#fff",border:"none",borderRadius:12,padding:"14px",fontWeight:700,fontSize:16,cursor:"pointer",marginTop:4}}>+ {addType==="expense"?"ì§€ì¶œ":"ìˆ˜ì…"} ì¶”ê°€</button>
              </div>
            )}

            {page==="stats"&&(
              <div>
                <div style={{display:"flex",background:"#f0f0f0",borderRadius:10,padding:3,marginBottom:20}}>
                  {[["expense","ì§€ì¶œ"],["income","ìˆ˜ì…"]].map(([k,l])=>(
                    <button key={k} onClick={()=>setStatsType(k)} style={{flex:1,padding:"9px 0",border:"none",borderRadius:8,background:statsType===k?"#fff":"transparent",color:statsType===k?k==="expense"?"#ef4444":"#10b981":"#888",fontWeight:statsType===k?700:400,fontSize:15,cursor:"pointer",boxShadow:statsType===k?"0 1px 4px rgba(0,0,0,0.1)":"none"}}>{l}</button>
                  ))}
                </div>
                {statsCats.length===0
                  ?<div style={{textAlign:"center",color:"#bbb",marginTop:60,fontSize:14}}><div style={{fontSize:36,marginBottom:12}}>ğŸ“Š</div>ì§‘ê³„ëœ ë‚´ì—­ì´ ì—†ì–´ìš”</div>
                  :<div>
                    <PieChart data={statsCats}/>
                    <div style={{display:"flex",flexDirection:"column",gap:8,marginTop:20}}>
                      {[...statsCats].sort((a,b)=>b.value-a.value).map((c,i)=>(
                        <div key={i} style={{background:"#fff",borderRadius:12,padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 1px 4px rgba(0,0,0,0.06)"}}>
                          <div style={{display:"flex",alignItems:"center",gap:10}}><div style={{width:12,height:12,borderRadius:"50%",background:c.color}}/><span style={{fontSize:14,fontWeight:500}}>{c.name}</span></div>
                          <div style={{textAlign:"right"}}><div style={{fontWeight:700,fontSize:15}}>{fmt(c.value)}</div><div style={{fontSize:12,color:"#aaa"}}>{statsTotal>0?((c.value/statsTotal)*100).toFixed(1):0}%</div></div>
                        </div>
                      ))}
                      <div style={{background:statsType==="expense"?"#fff0f0":"#f0fff8",borderRadius:12,padding:"12px 16px",display:"flex",justifyContent:"space-between",marginTop:4}}>
                        <span style={{fontWeight:700,color:statsType==="expense"?"#ef4444":"#10b981"}}>ì´ {statsType==="expense"?"ì§€ì¶œ":"ìˆ˜ì…"}</span>
                        <span style={{fontWeight:800,color:statsType==="expense"?"#ef4444":"#10b981",fontSize:16}}>{fmt(statsTotal)}</span>
                      </div>
                    </div>
                  </div>
                }
              </div>
            )}

            {page==="settings"&&(
              <div style={{display:"flex",flexDirection:"column",gap:16}}>
                <div>
                  <div style={{fontWeight:700,fontSize:15,marginBottom:12}}>ğŸ“… ì •ì‚° ê¸°ê°„</div>
                  <div style={{display:"flex",flexDirection:"column",gap:10}}>
                    <div><label style={lbl}>ì‹œì‘ì¼</label><input type="date" value={period.start} onChange={e=>setPeriod(p=>({...p,start:e.target.value}))} style={inp}/></div>
                    <div><label style={lbl}>ì¢…ë£Œì¼</label><input type="date" value={period.end} onChange={e=>setPeriod(p=>({...p,end:e.target.value}))} style={inp}/></div>
                  </div>
                </div>
                <div>
                  <div style={{fontWeight:700,fontSize:15,marginBottom:12}}>ğŸ’µ ì§€ì¶œ ì˜ˆì‚° (ì„ íƒ)</div>
                  <input type="number" placeholder="ì´ë²ˆ ë‹¬ ì˜ˆì‚°" value={budget} onChange={e=>setBudget(e.target.value)} style={inp}/>
                </div>
                <CatManager title="ğŸ·ï¸ ì§€ì¶œ ì¹´í…Œê³ ë¦¬" cats={expCats} setCats={setExpCats} newCat={newExpCat} setNewCat={setNewExpCat} color="#ef4444" excludedCats={excludedCats} toggleExclude={toggleExclude} showExclude={true}/>
                <CatManager title="ğŸ’š ìˆ˜ì… ì¹´í…Œê³ ë¦¬" cats={incCats} setCats={setIncCats} newCat={newIncCat} setNewCat={setNewIncCat} color="#10b981" excludedCats={excludedCats} toggleExclude={toggleExclude} showExclude={false}/>
                <div style={{background:"#fff",border:"1px solid #e8e8e8",borderRadius:14,overflow:"hidden"}}>
                  <div style={{padding:"14px 16px",borderBottom:"1px solid #f5f5f5"}}>
                    <div style={{fontWeight:700,fontSize:15,marginBottom:2}}>ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</div>
                    <div style={{fontSize:12,color:"#aaa"}}>ì›í•˜ëŠ” ê¸°ê°„ì˜ ë‚´ì—­ì„ JPG ì´ë¯¸ì§€ë¡œ ì €ì¥í•´ìš”</div>
                  </div>
                  <div style={{padding:"14px 16px",display:"flex",flexDirection:"column",gap:10}}>
                    <div><label style={lbl}>ì‹œì‘ì¼</label><input type="date" value={exportRange.start} onChange={e=>setExportRange(r=>({...r,start:e.target.value}))} style={inp}/></div>
                    <div><label style={lbl}>ì¢…ë£Œì¼</label><input type="date" value={exportRange.end} onChange={e=>setExportRange(r=>({...r,end:e.target.value}))} style={inp}/></div>
                    <button onClick={handleExport} disabled={exporting} style={{background:exporting?"#ccc":"#6366f1",color:"#fff",border:"none",borderRadius:12,padding:"13px",fontWeight:700,fontSize:15,cursor:exporting?"not-allowed":"pointer",marginTop:4}}>
                      {exporting?"ì €ì¥ ì¤‘...":"ğŸ“¥ JPGë¡œ ë‚´ë³´ë‚´ê¸°"}
                    </button>
                  </div>
                </div>
                <div style={{background:"#fff",border:"1px solid #e8e8e8",borderRadius:14,padding:"14px 16px"}}>
                  <div style={{fontWeight:700,fontSize:15,marginBottom:8,color:"#ef4444"}}>âš ï¸ ë°ì´í„° ì´ˆê¸°í™”</div>
                  <button onClick={()=>{if(window.confirm("ëª¨ë“  ë‚´ì—­ì„ ì‚­ì œí• ê¹Œìš”?"))setEntries([]);}} style={{background:"#fff",border:"1px solid #ef4444",color:"#ef4444",borderRadius:10,padding:"10px 20px",cursor:"pointer",fontWeight:600,fontSize:14}}>ì „ì²´ ë‚´ì—­ ì‚­ì œ</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
